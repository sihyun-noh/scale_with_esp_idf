// This file was generated by SquareLine Studio
// SquareLine Studio version: SquareLine Studio 1.3.4
// LVGL version: 8.3.6
// Project name: ms_type

#include "ui.h"
#include <stdio.h>
#include "ui_helpers.h"
#include "config.h"
#include "log.h"


static const char *TAG = "UI_LVGL";

extern float *read_weight(void);
extern cas_22byte_format_t *read_weight_value(void);

///////////////////// VARIABLES ////////////////////

// SCREEN: ui_Screen1
void ui_Screen1_screen_init(void);
lv_obj_t *ui_Screen1;
lv_obj_t *ui_Panel4;
lv_obj_t *ui_Label2;
lv_obj_t *ui_Label3;
lv_obj_t *ui_Label4;
lv_obj_t *ui_led1;
lv_obj_t *ui_led2;
lv_obj_t *ui_led3;
void ui_event_Button1( lv_event_t * e);
lv_obj_t *ui_Button1;


// SCREEN: ui_Screen2
void ui_Screen2_screen_init(void);
lv_obj_t *ui_Screen2;
lv_obj_t *ui_Keyboard1;
void ui_event_Button3( lv_event_t * e);
lv_obj_t *ui_Button3;
lv_obj_t *ui____initial_actions0;
void textarea_event_handler(lv_event_t * e);

uint32_t upper_weight_value = 0;
uint32_t lower_weight_value = 0;



///////////////////// TEST LVGL SETTINGS ////////////////////
#if LV_COLOR_DEPTH != 16
    #error "LV_COLOR_DEPTH should be 16bit to match SquareLine Studio's settings"
#endif
#if LV_COLOR_16_SWAP !=0
    #error "LV_COLOR_16_SWAP should be 0 to match SquareLine Studio's settings"
#endif


static lv_style_t style_clock;
char timeString[9];
char dateString[30];



///////////////////// ANIMATIONS ////////////////////

///////////////////// FUNCTIONS ////////////////////
void ui_event_Button1( lv_event_t * e) {
    lv_event_code_t event_code = lv_event_get_code(e);lv_obj_t * target = lv_event_get_target(e);
if ( event_code == LV_EVENT_CLICKED) {
      _ui_screen_change( &ui_Screen2, LV_SCR_LOAD_ANIM_FADE_ON, 500, 0, &ui_Screen2_screen_init);
}
}


///////////////////// SCREEN2 ////////////////////
void ui_event_Button3( lv_event_t * e) {
    lv_event_code_t event_code = lv_event_get_code(e);lv_obj_t * target = lv_event_get_target(e);
if ( event_code == LV_EVENT_CLICKED) {
      _ui_screen_change( &ui_Screen1, LV_SCR_LOAD_ANIM_FADE_ON, 100, 0, &ui_Screen1_screen_init);
}
}


void textarea_event_handler(lv_event_t * e)
{
    lv_event_code_t code = lv_event_get_code(e);
    lv_obj_t * ta = lv_event_get_target(e);
    LOGI(TAG,"Enter was pressed. The current text is: %s", lv_textarea_get_text(ta));
    
    upper_weight_value = atoi(lv_textarea_get_text(ta)); 
    /*Todo : */
    
}

void textarea_event_handler1(lv_event_t * e)
{
    lv_obj_t * ta = lv_event_get_target(e);
    LOGI(TAG,"Enter was pressed. The current text is: %s", lv_textarea_get_text(ta));
    lower_weight_value = atoi(lv_textarea_get_text(ta)); 
    /*Todo : */
    
}

void textarea_event_handler2(lv_event_t * e)
{
    lv_obj_t * ta = lv_event_get_target(e);
    LOGI(TAG,"Enter was pressed. The current text is: %s", lv_textarea_get_text(ta));
    upper_weight_value = atoi(lv_textarea_get_text(ta)); 
    /*Todo : */
    
}


void time_timer_cb(lv_timer_t *timer) {
//   time_t t = time(NULL);
//   struct tm *local = localtime(&t);
  cas_22byte_format_t *weight_raw = read_weight_value();  
  char s_weight[10] = { 0 };
  char count[10] = { 0 };
  float weight; 
  uint8_t int_count;
    // taking float value using %f format specifier for 
    // float 
  sscanf(weight_raw->data, "%f", &weight);
  int_count = (int)(weight/0.05);

  snprintf(s_weight, sizeof(s_weight), "%.3f", weight);
  snprintf(count, sizeof(count), "%d", (int)(weight/0.05));

//   LOGI(TAG, "Got SetConfig response, Call disable start button() %s", weight__);

//   sprintf(timeString, "%02d:%02d:%02d", local->tm_hour, local->tm_min, local->tm_sec);
//   sprintf(dateString, "%04d-%02d-%02d", local->tm_year + 1900, local->tm_mon + 1, local->tm_mday);

//   lv_label_set_text(ui_Screen1TimeLabel, timeString);
//   lv_label_set_text(ui_Screen1DateLabel, dateString);

//   lv_label_set_text(ui_SettingTimeLabel, timeString);
//   lv_label_set_text(ui_SettingDateLabel, dateString);

  lv_label_set_text(ui_Label2, s_weight); 
  lv_label_set_text(ui_Label3, count);
  if(int_count >= 5){
    lv_led_on(ui_led2);
  }else{
    lv_led_off(ui_led2);
  }

  if(strncmp(weight_raw->states,"ST",2) == 0){
    lv_led_on(ui_led1);
  }else{
    lv_led_off(ui_led1);
  }
  LOGI(TAG,"aaabaaa : %d\n",upper_weight_value);

}

///////////////////// SCREENS ////////////////////

void ui_init( void )
{LV_EVENT_GET_COMP_CHILD = lv_event_register_id();

lv_disp_t *dispp = lv_disp_get_default();
lv_theme_t *theme = lv_theme_default_init(dispp, lv_palette_main(LV_PALETTE_BLUE), lv_palette_main(LV_PALETTE_RED), false, LV_FONT_DEFAULT);
lv_disp_set_theme(dispp, theme);
ui_Screen1_screen_init();
ui_Screen2_screen_init();
ui____initial_actions0 = lv_obj_create(NULL);

lv_style_init(&style_clock);
static uint32_t user_data = 10;
lv_timer_t *time_timer = lv_timer_create(time_timer_cb, 1, &user_data);


lv_disp_load_scr( ui_Screen1);
}
